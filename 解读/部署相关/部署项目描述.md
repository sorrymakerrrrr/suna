# Kortix 项目部署服务描述

## 📋 概述

本文档详细描述了 Kortix AI 智能体平台中需要部署和配置的各个服务组件。这些服务按照功能层次分为基础设施层、AI 服务层和扩展功能层，共涉及 **12 个核心服务** 和 **5 个可选扩展服务**。

## 🏗️ 服务架构分层

```
┌─────────────────────────────────────────────────────────────────┐
│                        Kortix AI 智能体平台                      │
├─────────────────┬─────────────────┬─────────────────────────────┤
│   基础设施层     │   AI 服务层     │        扩展功能层            │
│                │                │                             │
│ • Supabase     │ • OpenAI       │ • RapidAPI                  │
│ • Daytona      │ • Anthropic    │ • Pipedream                 │
│ • Redis        │ • Google Gemini│ • Slack                     │
│ • Webhook      │ • OpenRouter   │                             │
│                │ • Morph        │                             │
│                │ • Tavily       │                             │
│                │ • Firecrawl    │                             │
└─────────────────┴─────────────────┴─────────────────────────────┘
```

---

## 🏢 基础设施层服务

### 1. Supabase 数据库服务
**服务类型**: 云数据库 + 认证服务
**部署方式**: SaaS 云服务
**重要程度**: 🔴 必需

**服务描述**:
- **功能**: 提供 PostgreSQL 数据库、用户认证、实时订阅、存储服务
- **角色**: 作为整个平台的数据存储和用户管理中心
- **特殊要求**:
  - 需要暴露 `basejump` 模式
  - 启用 `pg_cron` 和 `pg_net` 扩展
  - 运行数据库迁移脚本

**部署配置**:
```bash
# Supabase 项目的 API 端点 URL，用于所有数据库和认证请求
SUPABASE_URL=https://your-project.supabase.co

# 匿名访问密钥，用于客户端公开访问，权限受 RLS 策略限制
SUPABASE_ANON_KEY=eyJhbGciOiJIUzI1NiIsInR5cCI6...

# 服务角色密钥，拥有完整数据库访问权限，仅用于服务端操作
SUPABASE_SERVICE_ROLE_KEY=eyJhbGciOiJIUzI1NiIsInR5cCI6...
```

**获取方式**: [Supabase Dashboard](https://supabase.com/dashboard/projects)

---

### 2. Daytona 沙箱服务
**服务类型**: 云开发环境
**部署方式**: SaaS 云服务
**重要程度**: 🔴 必需

**服务描述**:
- **功能**: 提供隔离的代码执行环境和开发沙箱
- **角色**: 为 AI 智能体提供安全的代码运行环境
- **特殊要求**:
  - 必须创建名为 `kortix/suna:0.1.3.1` 的快照
  - 配置目标区域（默认 `us`）

**部署配置**:
```bash
# Daytona 平台的 API 访问密钥，用于创建和管理开发环境
DAYTONA_API_KEY=your-api-key

# Daytona 服务器的 API 端点地址，默认为官方云服务地址
DAYTONA_SERVER_URL=https://app.daytona.io/api

# 目标部署区域，影响沙箱环境的地理位置和延迟（us/eu/asia）
DAYTONA_TARGET=us
```

**获取方式**: [Daytona App](https://app.daytona.io/)

---

### 3. Redis 缓存服务
**服务类型**: 内存数据库
**部署方式**: Docker 容器 / 自托管
**重要程度**: 🔴 必需

**服务描述**:
- **功能**: 提供高性能缓存和会话存储
- **角色**: 缓存频繁访问的数据，提升系统响应速度
- **部署选项**:
  - Docker 模式: 自动部署 Redis 容器
  - 手动模式: 需要自行安装和配置 Redis

**部署配置**:
```bash
# Redis 服务器主机地址，Docker 模式下使用容器名，手动部署使用 IP 地址
REDIS_HOST=redis

# Redis 服务器端口号，默认为 6379，可根据实际部署情况调整
REDIS_PORT=6379
```

---

### 4. Webhook 回调服务
**服务类型**: HTTP 回调端点
**部署方式**: 公网可访问的 URL
**重要程度**: 🔴 必需

**服务描述**:
- **功能**: 接收外部服务的回调通知
- **角色**: 处理异步任务完成通知和第三方服务集成
- **部署要求**:
  - 必须是公网可访问的 URL
  - 本地开发建议使用 ngrok 或 localtunnel

**部署配置**:
```bash
# Webhook 回调的基础 URL，必须是公网可访问的地址，用于接收外部服务回调
WEBHOOK_BASE_URL=https://your-domain.ngrok.io

# Webhook 安全验证密钥，用于验证回调请求的合法性，防止恶意请求
TRIGGER_WEBHOOK_SECRET=auto-generated-secret
```

---

## 🤖 AI 服务层

### 5. 大语言模型提供商
**服务类型**: AI API 服务
**部署方式**: SaaS API 调用
**重要程度**: 🔴 必需（至少一个）

#### 5.1 OpenAI 服务
**服务描述**:
- **功能**: 提供 GPT 系列模型的 API 访问
- **默认模型**: `openai/gpt-5`
- **获取方式**: [OpenAI Platform](https://platform.openai.com/api-keys)

```bash
# OpenAI 平台的 API 密钥，用于访问 GPT 系列模型，格式为 sk-开头的字符串
OPENAI_API_KEY=sk-your-openai-key
```

#### 5.2 Anthropic Claude 服务
**服务描述**:
- **功能**: 提供 Claude 系列模型的 API 访问
- **默认模型**: `anthropic/claude-sonnet-4-20250514`
- **获取方式**: [Anthropic Console](https://console.anthropic.com/)

```bash
# Anthropic 平台的 API 密钥，用于访问 Claude 系列模型，格式为 sk-ant-开头的字符串
ANTHROPIC_API_KEY=sk-ant-your-anthropic-key
```

#### 5.3 Google Gemini 服务
**服务描述**:
- **功能**: 提供 Gemini 系列模型的 API 访问
- **默认模型**: `gemini/gemini-2.5-pro`
- **获取方式**: [Google AI Studio](https://makersuite.google.com/app/apikey)

```bash
# Google AI Studio 的 API 密钥，用于访问 Gemini 系列模型，通过 Google AI Studio 获取
GEMINI_API_KEY=your-gemini-key
```

#### 5.4 OpenRouter 聚合服务
**服务描述**:
- **功能**: 提供多个 AI 模型的统一 API 访问
- **默认模型**: `openrouter/google/gemini-2.5-pro`
- **获取方式**: [OpenRouter](https://openrouter.ai/keys)

```bash
# OpenRouter 平台的 API 密钥，用于访问多个 AI 模型的统一接口，提供模型聚合服务
OPENROUTER_API_KEY=your-openrouter-key
```

---

### 6. Morph 代码编辑服务
**服务类型**: AI 代码编辑 API
**部署方式**: SaaS API 调用
**重要程度**: 🟡 推荐

**服务描述**:
- **功能**: 提供 AI 驱动的智能代码编辑和重构
- **角色**: 增强代码编辑能力，提供更精准的代码修改
- **备选方案**: 如未配置，将使用 OpenRouter 作为备选

**部署配置**:
```bash
# Morph 平台的 API 密钥，用于访问 AI 驱动的智能代码编辑和重构服务
MORPH_API_KEY=your-morph-key
```

**获取方式**: [MorphLLM API Keys](https://morphllm.com/api-keys)

---

### 7. Tavily 搜索服务
**服务类型**: 智能搜索 API
**部署方式**: SaaS API 调用
**重要程度**: 🔴 必需

**服务描述**:
- **功能**: 提供智能网络搜索和信息检索
- **角色**: 为 AI 智能体提供实时信息获取能力
- **特点**: 专为 AI 应用优化的搜索结果

**部署配置**:
```bash
# Tavily 智能搜索平台的 API 密钥，用于访问专为 AI 应用优化的搜索服务，格式为 tvly-开头
TAVILY_API_KEY=tvly-your-tavily-key
```

**获取方式**: [Tavily](https://tavily.com)

---

### 8. Firecrawl 爬虫服务
**服务类型**: 网页爬取 API
**部署方式**: SaaS API 调用 / 自托管
**重要程度**: 🔴 必需

**服务描述**:
- **功能**: 提供网页内容爬取和结构化数据提取
- **角色**: 获取网页内容供 AI 智能体分析处理
- **部署选项**:
  - 云服务: 使用官方 API
  - 自托管: 部署自己的 Firecrawl 实例

**部署配置**:
```bash
# Firecrawl 平台的 API 密钥，用于访问网页爬取和数据提取服务，格式为 fc-开头
FIRECRAWL_API_KEY=fc-your-firecrawl-key

# Firecrawl 服务的 API 端点地址，默认为官方云服务，自托管时需修改为自己的服务地址
FIRECRAWL_URL=https://api.firecrawl.dev
```

**获取方式**: [Firecrawl](https://firecrawl.dev)

---

## 🔧 扩展功能层

### 9. RapidAPI 工具集成
**服务类型**: API 聚合平台
**部署方式**: SaaS API 调用
**重要程度**: 🔵 可选

**服务描述**:
- **功能**: 提供丰富的第三方 API 工具集成
- **角色**: 扩展 AI 智能体的工具能力（如 LinkedIn 爬虫等）
- **使用场景**: 需要特定工具或数据源时启用

**部署配置**:
```bash
# RapidAPI 平台的 API 密钥，用于访问第三方 API 工具集成，扩展智能体工具能力
RAPID_API_KEY=your-rapidapi-key
```

**获取方式**: [RapidAPI](https://rapidapi.com/)

---

### 10. Pipedream 工作流服务
**服务类型**: 工作流自动化平台
**部署方式**: SaaS 云服务
**重要程度**: 🔵 可选

**服务描述**:
- **功能**: 提供工作流自动化和集成能力
- **角色**: 连接不同服务，实现复杂的自动化流程
- **使用场景**: 需要复杂业务流程自动化时启用

**部署配置**:
```bash
# Pipedream 项目的唯一标识符，用于标识特定的工作流项目
PIPEDREAM_PROJECT_ID=your-project-id

# Pipedream OAuth 应用的客户端 ID，用于身份验证和授权
PIPEDREAM_CLIENT_ID=your-client-id

# Pipedream OAuth 应用的客户端密钥，用于安全的身份验证
PIPEDREAM_CLIENT_SECRET=your-client-secret

# Pipedream 环境标识，指定运行环境（development/staging/production）
PIPEDREAM_X_PD_ENVIRONMENT=development
```

**获取方式**: [Pipedream Connect](https://pipedream.com/connect)

---

### 11. Slack 团队协作集成
**服务类型**: 团队协作平台集成
**部署方式**: OAuth 应用集成
**重要程度**: 🔵 可选

**服务描述**:
- **功能**: 与 Slack 工作空间集成，支持消息通知和交互
- **角色**: 提供团队协作和通知能力
- **使用场景**: 团队使用 Slack 进行协作时启用

**部署配置**:
```bash
# Slack 应用的客户端 ID，用于标识 Slack 应用，在 Slack API 控制台获取
SLACK_CLIENT_ID=your-slack-client-id

# Slack 应用的客户端密钥，用于安全验证 Slack 应用身份，需要保密
SLACK_CLIENT_SECRET=your-slack-client-secret

# Slack OAuth 授权完成后的回调地址，用户授权后 Slack 会重定向到此地址
SLACK_REDIRECT_URI=http://localhost:3000/api/integrations/slack/callback
```

**获取方式**: [Slack API Apps](https://api.slack.com/apps)

---

## 🔐 自动生成服务

### 12. Kortix 管理服务
**服务类型**: 内部管理 API
**部署方式**: 自动生成
**重要程度**: 🤖 自动

**服务描述**:
- **功能**: 提供平台管理和配置功能
- **角色**: 内部管理接口，控制平台行为
- **生成方式**: 安装向导自动生成 64 位十六进制密钥

---

### 13. MCP 协议服务
**服务类型**: 模型上下文协议
**部署方式**: 自动生成
**重要程度**: 🤖 自动

**服务描述**:
- **功能**: 提供模型上下文协议的加密和认证
- **角色**: 保护 AI 模型交互的安全性
- **生成方式**: 自动生成 256 位 Base64 编码密钥

---

## 📊 服务部署优先级

### 🔴 第一优先级（必须部署）
1. **Supabase** - 数据存储和用户认证
2. **Daytona** - 代码执行环境
3. **Redis** - 缓存服务
4. **至少一个 LLM 提供商** - AI 能力核心
5. **Tavily + Firecrawl** - 信息获取能力
6. **Webhook** - 异步通信

### 🟡 第二优先级（强烈推荐）
1. **Morph** - 增强代码编辑能力
2. **多个 LLM 提供商** - 提高可用性和性能

### 🔵 第三优先级（按需部署）
1. **RapidAPI** - 扩展工具集成
2. **Pipedream** - 工作流自动化
3. **Slack** - 团队协作

---

## 🚀 部署建议

### 开发环境部署
```bash
# 最小化部署（仅核心服务）
- Supabase（免费层）
- Daytona（免费层）
- Redis（Docker 本地）
- OpenAI（按需付费）
- Tavily + Firecrawl（免费层）
- ngrok（免费层）
```

### 生产环境部署
```bash
# 完整部署（包含冗余和扩展）
- Supabase（付费计划）
- Daytona（付费计划）
- Redis（云托管）
- 多个 LLM 提供商（负载均衡）
- Morph（增强功能）
- 所有扩展服务（按需）
- 专用域名和 SSL
```

### 成本优化建议
1. **免费层优先**: 大多数服务都提供免费层，适合开发和小规模使用
2. **按需扩展**: 从核心服务开始，根据实际需求逐步添加扩展服务
3. **监控使用量**: 设置 API 使用量监控，避免意外费用
4. **定期评估**: 定期评估服务使用情况，优化成本结构

---

## 🔧 部署验证

### 服务连通性检查
```bash
# 检查所有服务状态
curl -f $SUPABASE_URL/rest/v1/ -H "apikey: $SUPABASE_ANON_KEY"
curl -f $DAYTONA_SERVER_URL/health -H "Authorization: Bearer $DAYTONA_API_KEY"
redis-cli -h $REDIS_HOST -p $REDIS_PORT ping
```

### 配置完整性验证
```bash
# 验证必需配置
python -c "
import os
required = ['SUPABASE_URL', 'DAYTONA_API_KEY', 'TAVILY_API_KEY', 'FIRECRAWL_API_KEY']
missing = [k for k in required if not os.getenv(k)]
print('Missing required configs:', missing if missing else 'None')
"
```

---

## 📚 相关文档

- [配置信息项总结.md](./配置信息项总结.md) - 详细配置说明
- [模块说明.md](./模块说明.md) - 项目架构详解
- [学习路径.md](./学习路径.md) - 源码学习指南

---

**完成所有必需服务的部署后，你就拥有了一个功能完整的 Kortix AI 智能体平台！** 🎉
