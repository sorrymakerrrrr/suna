# Kortix 项目配置信息项总结

## 📋 概述

本文档基于 `setup.py` 安装向导，详细总结了 Kortix AI 智能体平台所需的所有配置信息项。安装向导共包含 **17 个步骤**，涵盖了从基础设施到高级功能的完整配置。

## 🏗️ 配置架构图

```
┌─────────────────┐    ┌─────────────────┐    ┌─────────────────┐
│   基础设施层      │    │   AI 服务层     │    │   扩展功能层     │
├─────────────────┤    ├─────────────────┤    ├─────────────────┤
│ • Supabase      │    │ • LLM 提供商     │    │ • RapidAPI      │
│ • Daytona       │    │ • Morph 代码编辑 │    │ • Pipedream     │
│ • Redis         │    │ • 搜索服务       │    │ • Slack         │
│ • Webhook       │    │                 │    │ • MCP           │
└─────────────────┘    └─────────────────┘    └─────────────────┘
```

## 📝 详细配置信息项

### 🔧 第1步：安装方式选择

**配置项**: `setup_method`
- **选项**:
  - `docker` - Docker Compose 方式（推荐）
  - `manual` - 手动安装方式
- **说明**: 决定后续的依赖检查和启动方式

---

### 🏢 第3步：Supabase 数据库配置

**必需配置** ✅

| 配置项 | 环境变量 | 说明 | 示例 |
|--------|----------|------|------|
| **项目 URL** | `SUPABASE_URL` | Supabase 项目的 API 端点 | `https://xyz.supabase.co` |
| **匿名密钥** | `SUPABASE_ANON_KEY` | 公开的匿名访问密钥 | `eyJhbGciOiJIUzI1NiIsInR5cCI6...` |
| **服务角色密钥** | `SUPABASE_SERVICE_ROLE_KEY` | 服务端完全访问密钥 | `eyJhbGciOiJIUzI1NiIsInR5cCI6...` |

**获取方式**:
- 访问 [Supabase Dashboard](https://supabase.com/dashboard/projects)
- 创建项目后，在 Project Settings → API 中获取

**前端配置**:
- `NEXT_PUBLIC_SUPABASE_URL` = `SUPABASE_URL`
- `NEXT_PUBLIC_SUPABASE_ANON_KEY` = `SUPABASE_ANON_KEY`

---

### 🔒 第4步：Daytona 沙箱配置

**必需配置** ✅

| 配置项 | 环境变量 | 说明 | 默认值 |
|--------|----------|------|--------|
| **API 密钥** | `DAYTONA_API_KEY` | Daytona 平台的 API 访问密钥 | - |
| **服务器 URL** | `DAYTONA_SERVER_URL` | Daytona API 服务器地址 | `https://app.daytona.io/api` |
| **目标区域** | `DAYTONA_TARGET` | 部署目标区域 | `us` |

**获取方式**:
- 访问 [Daytona App](https://app.daytona.io/)
- 注册账户后，在 Keys 菜单中生成 API 密钥

**重要提醒**: 必须创建名为 `kortix/suna:0.1.3.1` 的快照

---

### 🤖 第5步：大语言模型 (LLM) 配置

**必需配置** ✅ (至少一个提供商)

| 提供商 | 环境变量 | 获取地址 | 默认模型 |
|--------|----------|----------|----------|
| **OpenAI** | `OPENAI_API_KEY` | [OpenAI Platform](https://platform.openai.com/api-keys) | `openai/gpt-5` |
| **Anthropic** | `ANTHROPIC_API_KEY` | [Anthropic Console](https://console.anthropic.com/) | `anthropic/claude-sonnet-4-20250514` |
| **Google Gemini** | `GEMINI_API_KEY` | [Google AI Studio](https://makersuite.google.com/app/apikey) | `gemini/gemini-2.5-pro` |
| **OpenRouter** | `OPENROUTER_API_KEY` | [OpenRouter](https://openrouter.ai/keys) | `openrouter/google/gemini-2.5-pro` |

**模型选择**: `MODEL_TO_USE` - 根据配置的第一个提供商自动设置

**配置策略**:
- 至少配置一个提供商
- 支持多提供商同时配置
- 优先级：OpenAI → Anthropic → Gemini → OpenRouter

---

### ✏️ 第6步：Morph 代码编辑配置

**推荐配置** 🔶

| 配置项 | 环境变量 | 说明 |
|--------|----------|------|
| **Morph API 密钥** | `MORPH_API_KEY` | AI 驱动的代码编辑服务 |

**获取方式**: [MorphLLM API Keys](https://morphllm.com/api-keys)

**备选方案**: 如果未配置 Morph，将使用 OpenRouter 作为代码编辑的备选方案

---

### 🔍 第7步：搜索和爬虫服务配置

**必需配置** ✅

| 服务 | 环境变量 | 说明 | 获取地址 |
|------|----------|------|----------|
| **Tavily 搜索** | `TAVILY_API_KEY` | 智能搜索服务 | [Tavily](https://tavily.com) |
| **Firecrawl 爬虫** | `FIRECRAWL_API_KEY` | 网页爬取服务 | [Firecrawl](https://firecrawl.dev) |
| **Firecrawl URL** | `FIRECRAWL_URL` | 服务端点 | `https://api.firecrawl.dev` (默认) |

**自托管选项**: 如果自托管 Firecrawl，需要配置自定义 URL

---

### 🚀 第8步：RapidAPI 配置

**可选配置** 🔵

| 配置项 | 环境变量 | 说明 |
|--------|----------|------|
| **RapidAPI 密钥** | `RAPID_API_KEY` | 扩展工具集成（如 LinkedIn 爬虫） |

**获取方式**: [RapidAPI](https://rapidapi.com/)

---

### 🔑 第9步：Kortix 管理配置

**自动生成** 🤖

| 配置项 | 环境变量 | 说明 |
|--------|----------|------|
| **管理员 API 密钥** | `KORTIX_ADMIN_API_KEY` | 平台管理功能的访问密钥 |

**生成方式**: 安装向导自动生成 64 位十六进制密钥

---

### 🌐 第10步：Webhook 配置

**必需配置** ✅

| 配置项 | 环境变量 | 说明 | 示例 |
|--------|----------|------|------|
| **Webhook 基础 URL** | `WEBHOOK_BASE_URL` | 公网可访问的回调地址 | `https://your-domain.ngrok.io` |
| **Webhook 密钥** | `TRIGGER_WEBHOOK_SECRET` | 认证密钥（自动生成） | - |

**本地开发**: 使用 ngrok 或 localtunnel 暴露 `http://localhost:8000`

---

### 🔐 第11步：MCP (Model Context Protocol) 配置

**自动生成** 🤖

| 配置项 | 环境变量 | 说明 |
|--------|----------|------|
| **加密密钥** | `MCP_CREDENTIAL_ENCRYPTION_KEY` | MCP 凭证加密密钥 |

**生成方式**: 自动生成 256 位 Base64 编码密钥

---

### 🔄 第12步：Pipedream 工作流配置

**可选配置** 🔵

| 配置项 | 环境变量 | 说明 |
|--------|----------|------|
| **项目 ID** | `PIPEDREAM_PROJECT_ID` | Pipedream Connect 项目标识 |
| **客户端 ID** | `PIPEDREAM_CLIENT_ID` | OAuth 客户端标识 |
| **客户端密钥** | `PIPEDREAM_CLIENT_SECRET` | OAuth 客户端密钥 |
| **环境** | `PIPEDREAM_X_PD_ENVIRONMENT` | 运行环境 (`development`/`production`) |

**获取方式**: [Pipedream Connect](https://pipedream.com/connect)

---

### 💬 第13步：Slack 集成配置

**可选配置** 🔵

| 配置项 | 环境变量 | 说明 | 默认值 |
|--------|----------|------|--------|
| **客户端 ID** | `SLACK_CLIENT_ID` | Slack 应用客户端 ID | - |
| **客户端密钥** | `SLACK_CLIENT_SECRET` | Slack 应用客户端密钥 | - |
| **重定向 URI** | `SLACK_REDIRECT_URI` | OAuth 回调地址 | `http://localhost:3000/api/integrations/slack/callback` |

**获取方式**: [Slack API Apps](https://api.slack.com/apps)

---

## 🗂️ 环境文件结构

### 后端环境文件 (`backend/.env`)

```bash
# 基础配置
ENV_MODE=local
NEXT_PUBLIC_URL=http://localhost:3000

# Supabase 配置
SUPABASE_URL=https://xyz.supabase.co
SUPABASE_ANON_KEY=eyJhbGciOiJIUzI1NiIsInR5cCI6...
SUPABASE_SERVICE_ROLE_KEY=eyJhbGciOiJIUzI1NiIsInR5cCI6...

# Redis 配置
REDIS_HOST=redis  # Docker 模式
REDIS_PORT=6379

# LLM 配置
OPENAI_API_KEY=sk-...
ANTHROPIC_API_KEY=sk-ant-...
MODEL_TO_USE=openai/gpt-5

# 搜索服务
TAVILY_API_KEY=tvly-...
FIRECRAWL_API_KEY=fc-...
FIRECRAWL_URL=https://api.firecrawl.dev

# Daytona 沙箱
DAYTONA_API_KEY=...
DAYTONA_SERVER_URL=https://app.daytona.io/api
DAYTONA_TARGET=us

# Webhook 配置
WEBHOOK_BASE_URL=https://your-domain.ngrok.io
TRIGGER_WEBHOOK_SECRET=...

# 管理配置
KORTIX_ADMIN_API_KEY=...
MCP_CREDENTIAL_ENCRYPTION_KEY=...

# 可选服务
RAPID_API_KEY=...
MORPH_API_KEY=...
SLACK_CLIENT_ID=...
SLACK_CLIENT_SECRET=...
SLACK_REDIRECT_URI=...
PIPEDREAM_PROJECT_ID=...
PIPEDREAM_CLIENT_ID=...
PIPEDREAM_CLIENT_SECRET=...
PIPEDREAM_X_PD_ENVIRONMENT=development
```

### 前端环境文件 (`frontend/.env.local`)

```bash
# Supabase 公开配置
NEXT_PUBLIC_SUPABASE_URL=https://xyz.supabase.co
NEXT_PUBLIC_SUPABASE_ANON_KEY=eyJhbGciOiJIUzI1NiIsInR5cCI6...

# API 配置
NEXT_PUBLIC_BACKEND_URL=http://localhost:8000/api
NEXT_PUBLIC_URL=http://localhost:3000
NEXT_PUBLIC_ENV_MODE=LOCAL

# 管理配置
KORTIX_ADMIN_API_KEY=...
```

---

## ✅ 配置检查清单

### 必需配置 (🔴 必须完成)
- [ ] **Supabase**: URL、匿名密钥、服务角色密钥
- [ ] **Daytona**: API 密钥和快照创建
- [ ] **LLM 提供商**: 至少一个 API 密钥
- [ ] **搜索服务**: Tavily 和 Firecrawl API 密钥
- [ ] **Webhook**: 公网可访问的基础 URL

### 推荐配置 (🟡 强烈建议)
- [ ] **Morph**: 代码编辑 API 密钥
- [ ] **多个 LLM 提供商**: 提高可用性和性能

### 可选配置 (🔵 按需配置)
- [ ] **RapidAPI**: 扩展工具集成
- [ ] **Pipedream**: 工作流自动化
- [ ] **Slack**: 团队协作集成

### 自动生成 (🤖 无需手动配置)
- [ ] **Kortix 管理密钥**: 自动生成
- [ ] **MCP 加密密钥**: 自动生成
- [ ] **Webhook 密钥**: 自动生成

---

## 🚨 重要注意事项

### 1. **安全性**
- 所有 API 密钥都是敏感信息，不要提交到版本控制
- 使用强密码和安全的密钥管理实践
- 定期轮换 API 密钥

### 2. **网络要求**
- Webhook URL 必须是公网可访问的
- 本地开发建议使用 ngrok 或类似工具
- 确保防火墙允许必要的端口访问

### 3. **数据库设置**
- 必须手动在 Supabase 中暴露 `basejump` 模式
- 确保启用 `pg_cron` 和 `pg_net` 扩展
- 运行数据库迁移

### 4. **服务依赖**
- Redis 是必需的缓存服务
- Docker 模式下自动处理服务依赖
- 手动模式需要按顺序启动服务

### 5. **成本考虑**
- 大多数服务都有免费额度
- 根据使用量选择合适的付费计划
- 监控 API 使用量避免意外费用

---

## 🔄 配置更新和维护

### 更新配置
1. 直接编辑 `.env` 文件
2. 重新运行 `python setup.py` 覆盖配置
3. 删除 `.setup_progress` 文件重新开始

### 配置验证
```bash
# 检查配置文件
cat backend/.env
cat frontend/.env.local

# 验证服务连接
docker-compose config
```

### 故障排查
- 检查 API 密钥有效性
- 验证网络连接
- 查看服务日志
- 确认环境变量加载

---

## 📚 相关文档

- [模块说明.md](./模块说明.md) - 项目架构详解
- [学习路径.md](./学习路径.md) - 源码学习指南
- [Supabase 文档](https://supabase.com/docs)
- [Docker Compose 文档](https://docs.docker.com/compose/)

---

**配置完成后，你就可以启动完整的 Kortix AI 智能体平台了！** 🎉
